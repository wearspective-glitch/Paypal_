 <!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Casino Test ‚Äî Int√©gration Stripe (Sandbox)</title>
<style>
  :root{--bg:#f7f8fc;--card:#fff;--muted:#8b8f98;--accent:#000;--gold:#ffd166}
  body{margin:0;font-family:Inter,Arial;background:var(--bg);color:#111;display:flex;justify-content:center;padding:18px}
  .wrap{width:100%;max-width:420px}
  .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 6px 20px rgba(20,20,40,0.06)}
  header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .logo{width:34px;height:34px;border-radius:8px;overflow:hidden}
  .logo img{width:100%;height:100%;object-fit:cover}
  .balance{font-weight:800;font-size:28px;margin-top:4px}
  .small{font-size:13px;color:var(--muted)}
  .controls{display:flex;gap:8px;align-items:center;margin:12px 0}
  input[type="number"]{padding:8px;border-radius:8px;border:1px solid #e6e8ef;width:120px}
  button{background:#000;color:#fff;border:0;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:700}
  .slot{display:flex;gap:8px;justify-content:center;margin:12px 0}
  .reel{width:84px;height:84px;border-radius:12px;background:#f3f4f9;display:flex;align-items:center;justify-content:center;font-size:34px;font-weight:800}
  .result{min-height:22px;margin-top:8px;font-weight:700}
  .row{display:flex;gap:8px;align-items:center}
  .muted{color:var(--muted)}
  .footer{margin-top:12px;display:flex;justify-content:space-between;align-items:center}
  .bottom-fixed{position:fixed;left:50%;transform:translateX(-50%);bottom:0;width:100%;max-width:420px;padding:12px;background:#fff;border-radius:16px 16px 0 0;box-shadow:0 -6px 20px rgba(0,0,0,0.08)}
  .bottom-fixed .btns{display:flex;gap:10px}
  .bottom-fixed button{flex:1;padding:12px;border-radius:28px}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:flex-end;justify-content:center;z-index:999}
  .sheet{background:#fff;width:100%;max-width:420px;border-radius:18px 18px 0 0;padding:20px 18px}
  .sheet h3{text-align:center;margin:0 0 12px 0;font-size:22px}
  .sheet .actions{display:flex;justify-content:space-around;margin-top:12px}
  .icon-circle{width:70px;height:70px;border-radius:35px;background:#f3f4f9;display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo"><img src="https://cdn.shopify.com/s/files/1/0602/1857/3035/files/IMG_2477.jpg?v=1762027810" alt="logo"></div>
        <div>
          <div class="small">Solde (test)</div>
          <div id="balance" class="balance">0 ‚Ç¨</div>
        </div>
        <div style="margin-left:auto" class="muted">Mode Sandbox</div>
      </header>

      <div class="controls">
        <label class="small">Mise</label>
        <input id="bet" type="number" value="100" min="1" max="10000">
        <button id="spin">SPIN</button>
        <button id="addCredits" style="background:#eee;color:#111;border-radius:10px;padding:8px 10px">+1000</button>
      </div>

      <div class="slot">
        <div class="reel" id="r1">üçí</div>
        <div class="reel" id="r2">üçã</div>
        <div class="reel" id="r3">üîî</div>
      </div>

      <div id="result" class="result muted"></div>
      <div class="footer muted"><div>RTP (simul√©) ~94%</div><div>Historique ci-dessous</div></div>
      <div id="log" style="margin-top:10px;max-height:180px;overflow:auto;background:#fafbff;padding:8px;border-radius:8px;font-size:13px"></div>
    </div>
  </div>

  <!-- bottom bar with deposit (Checkout) and withdraw (simulate) -->
  <div class="bottom-fixed">
    <div class="btns">
      <button id="depositBtn">D√©p√¥t (Stripe test)</button>
      <button id="receiveBtn">Recevoir (Retrait demo)</button>
    </div>
  </div>

  <!-- slide up sheet (pour 'Recevoir des paiements') -->
  <div id="sheetBackdrop" style="display:none" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="sheet">
      <button id="closeSheet" style="float:right;border:0;background:transparent;font-size:20px">‚úï</button>
      <h3>Moyens pour recevoir des paiements</h3>
      <div class="actions">
        <div style="text-align:center">
          <div class="icon-circle">üí∏</div>
          <div class="small" style="margin-top:8px">Demander de l'argent</div>
        </div>
        <div style="text-align:center">
          <div class="icon-circle">üßæ</div>
          <div class="small" style="margin-top:8px">Envoyer une facture</div>
        </div>
        <div style="text-align:center">
          <div class="icon-circle">üî≥</div>
          <div class="small" style="margin-top:8px">Afficher un QR code</div>
        </div>
      </div>
    </div>
  </div>

<script>
/* frontend logic similaire √† la demo pr√©c√©dente */
const symbols = ['üçí','üçã','üîî','‚≠ê','üíé','7Ô∏è‚É£'];
function pickRandom(){ return symbols[Math.floor(Math.random()*symbols.length)]; }

function readBalance(){
  const b = localStorage.getItem('realish_balance_v1');
  return b ? Number(b) : 5000;
}
function writeBalance(v){
  localStorage.setItem('realish_balance_v1', String(Math.max(0, Math.floor(v))));
  document.getElementById('balance').textContent = Number(localStorage.getItem('realish_balance_v1')).toLocaleString('fr-FR') + ' ‚Ç¨';
}
function logLine(text){
  const log = document.getElementById('log');
  const el = document.createElement('div');
  el.innerHTML = text;
  log.prepend(el);
  while (log.children.length > 120) log.removeChild(log.lastChild);
}
writeBalance(readBalance());

document.getElementById('addCredits').addEventListener('click',()=>{
  const b=readBalance()+1000;
  writeBalance(b);
  logLine('<em>+1000 cr√©dits (demo)</em>');
});

let spinning=false;
document.getElementById('spin').addEventListener('click',()=>{
  if (spinning) return;
  spinning=true;
  const bet = Math.max(1, Math.min(10000, Math.floor(Number(document.getElementById('bet').value)||0)));
  let bal = readBalance();
  if (bet > bal) { alert('Solde insuffisant'); spinning=false; return; }
  bal -= bet; writeBalance(bal);
  const spinD = 900, int=80, start=Date.now();
  const r1=document.getElementById('r1'), r2=document.getElementById('r2'), r3=document.getElementById('r3');
  const t = setInterval(()=>{
    r1.textContent = pickRandom(); r2.textContent = pickRandom(); r3.textContent = pickRandom();
    if (Date.now()-start > spinD){
      clearInterval(t);
      const s1 = pickRandom(), s2 = pickRandom(), s3 = pickRandom();
      r1.textContent=s1; r2.textContent=s2; r3.textContent=s3;
      evaluate([s1,s2,s3], bet);
      spinning=false;
    }
  }, int);
});

function evaluate(arr, bet){
  const [a,b,c]=arr;
  let bal = readBalance();
  let payout=0, msg='';
  if (a===b && b===c){
    const mult={'üçí':5,'üçã':6,'üîî':10,'‚≠ê':20,'üíé':50,'7Ô∏è‚É£':200};
    payout = (mult[a]||5)*bet;
    msg = `Jackpot ${a} x3 ‚Äî Gagn√© +${payout} cr√©dits`;
  } else if (a===b||a===c||b===c){
    payout = Math.floor(bet*1.2);
    if ((a==='7Ô∏è‚É£'&&b==='7Ô∏è‚É£')||(a==='7Ô∏è‚É£'&&c==='7Ô∏è‚É£')||(b==='7Ô∏è‚É£'&&c==='7Ô∏è‚É£')) payout = Math.floor(bet*10);
    msg = `Deux identiques ‚Äî Gagn√© +${payout} cr√©dits`;
  } else {
    msg = `Perdu -${bet} cr√©dits`;
  }
  bal += payout; writeBalance(bal);
  logLine(`<strong>${new Date().toLocaleTimeString()}</strong> ‚Äî ${arr.join(' ')} ‚Äî Mise ${bet} ‚Äî ${payout>0?('+'+payout):'0'}`);
  document.getElementById('result').textContent = msg;
}

/* ---------- Stripe deposit flow (frontend) ---------- */
/*
  Pour que √ßa fonctionne en r√©el test :
  - D√©ploie le backend Node.js (server.js) plus haut, accessible publiquement (ngrok ou serveur)
  - Dans .env du backend, mets BASE_URL = url publique (ex: https://abcd.ngrok.io)
  - Mets STRIPE_SECRET_KEY √† ta cl√© sk_test_...
  - Dans la page ci-dessus, modifie API_BASE sur la ligne suivante pour pointer vers ton serveur
*/
const API_BASE = 'http://localhost:4242'; // <-- change ceci vers ton serveur (ngrok/host)
document.getElementById('depositBtn').addEventListener('click', async ()=>{
  try {
    const amountEur = prompt('Montant √† d√©poser en euros (ex: 10 pour 10‚Ç¨) :', '10');
    if (!amountEur) return;
    const cents = Math.max(100, Math.floor(Number(amountEur)*100));
    // create checkout session on backend
    const res = await fetch(API_BASE + '/create-checkout-session', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ amount: cents, clientReferenceId: 'demo_user_1' })
    });
    const data = await res.json();
    if (data.url) {
      // redirect user to Stripe Checkout (test)
      window.location.href = data.url;
    } else {
      alert('Erreur cr√©ation session: ' + (data.error || 'unknown'));
      console.error(data);
    }
  } catch (err) {
    alert('Erreur: ' + err.message);
    console.error(err);
  }
});

/* After Stripe success page, you can implement success.html that calls /checkout-session?session_id=... and credits the user.
   For demo, if you don't want server redirects, you can manually click +1000 after a successful test payment in your Stripe dashboard.
*/

/* ---------- Recevoir / sheet ---------- */
const sheet = document.getElementById('sheetBackdrop');
document.getElementById('receiveBtn').addEventListener('click', ()=> sheet.style.display='flex');
document.getElementById('closeSheet').addEventListener('click', ()=> sheet.style.display='none');
</script>
</body>
</html>