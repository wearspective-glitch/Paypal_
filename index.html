<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bart Run - Famille Simpson</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: sans-serif;
}

#game {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

#player {
  position: absolute;
  width: 60px;
  height: 60px;
  background-image: url('https://upload.wikimedia.org/wikipedia/en/0/0d/Bart_Simpson_200px.png');
  background-size: cover;
  background-position: center;
  bottom: 100px; /* aligné sur le sol */
}

.obstacle {
  position: absolute;
  width: 60px;
  height: 60px;
  background-size: cover;
  background-position: center;
  bottom: 100px; /* aligné sur le sol */
}

#score {
  position: absolute;
  top: 10px;
  left: 10px;
  color: white;
  font-size: 24px;
}

#message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 36px;
  text-align: center;
  display: none;
}

#restartBtn {
  display: none;
  position: absolute;
  top: 60%;
  left: 50%;
  transform: translateX(-50%);
  padding: 15px 30px;
  font-size: 24px;
  background: red;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}
</style>
</head>
<body>
<div id="game">
  <div id="player"></div>
  <div id="score">0</div>
  <div id="message">Game Over</div>
  <button id="restartBtn">Recommencer</button>
</div>

<script>
const game = document.getElementById('game');
const player = document.getElementById('player');
const scoreEl = document.getElementById('score');
const messageEl = document.getElementById('message');
const restartBtn = document.getElementById('restartBtn');

let obstacles = [];
let score = 0;
let gameOverFlag = false;
let jump = false;
let jumpHeight = 0;
const jumpSpeed = 18;
const gravity = 6;
const groundOffset = 100;

let timeElapsed = 0;
let scoreInterval;

// Images obstacles (Famille Simpson sauf Bart)
const simpsons = [
  'https://upload.wikimedia.org/wikipedia/en/0/02/Homer_Simpson_2006.png',
  'https://upload.wikimedia.org/wikipedia/en/0/0b/Marge_Simpson.png',
  'https://upload.wikimedia.org/wikipedia/en/0/04/Lisa_Simpson.png',
  'https://upload.wikimedia.org/wikipedia/en/e/ec/Maggie_Simpson.png'
];

// --- Créer obstacle ---
function createObstacle() {
  if(gameOverFlag) return;
  const obs = document.createElement('div');
  obs.classList.add('obstacle');

  const img = simpsons[Math.floor(Math.random()*simpsons.length)];
  obs.style.backgroundImage = `url(${img})`;

  obs.style.width = 60;
  obs.style.height = 60;
  obs.style.bottom = groundOffset + 'px'; // aligné sur le sol
  obs.style.left = window.innerWidth + 'px';

  game.appendChild(obs);
  obstacles.push(obs);
}

// --- Boucle jeu ---
function gameLoop() {
  if(gameOverFlag) return;

  // Gestion saut
  if(jump){
    jumpHeight += jumpSpeed;
    if(jumpHeight >= 200) jump = false;
  } else if(jumpHeight > 0){
    jumpHeight -= gravity;
    if(jumpHeight < 0) jumpHeight = 0;
  }
  player.style.bottom = groundOffset + jumpHeight + 'px';

  // Déplacer obstacles
  for(let i = obstacles.length -1; i >=0; i--){
    const obs = obstacles[i];
    let x = parseFloat(obs.style.left);
    x -= 8;
    obs.style.left = x + 'px';

    const playerRect = player.getBoundingClientRect();
    const obsRect = obs.getBoundingClientRect();

    if(playerRect.left < obsRect.right &&
       playerRect.right > obsRect.left &&
       playerRect.bottom > obsRect.top &&
       playerRect.top < obsRect.bottom){
      endGame();
    }

    if(x + parseFloat(obs.style.width) < 0){
      obs.remove();
      obstacles.splice(i,1);
    }
  }

  requestAnimationFrame(gameLoop);
}

// --- Score ---
function startScore() {
  scoreInterval = setInterval(() => {
    timeElapsed++;
    score += timeElapsed; 
    scoreEl.innerText = score;

    if(score >= 150){
      document.body.style.background = 'white';
    } else {
      document.body.style.background = 'black';
    }
  }, 1000);
}

// --- Game Over ---
function endGame(){
  gameOverFlag = true;
  clearInterval(scoreInterval);
  messageEl.style.display = 'block';
  restartBtn.style.display = 'block';
}

// --- Redémarrer ---
function restartGame(){
  obstacles.forEach(o => o.remove());
  obstacles = [];
  score = 0;
  timeElapsed = 0;
  scoreEl.innerText = score;
  jumpHeight = 0;
  jump = false;
  player.style.bottom = groundOffset + 'px';
  messageEl.style.display = 'none';
  restartBtn.style.display = 'none';
  gameOverFlag = false;
  document.body.style.background = 'black';
  gameLoop();
  startScore();

  setTimeout(() => {
    if(!gameOverFlag) createObstacle();
    setInterval(() => { if(!gameOverFlag) createObstacle(); }, 1500);
  }, 5000 + Math.random()*2000);
}

// --- Contrôles ---
document.addEventListener('keydown', e => {
  if(e.code === 'Space' && !jump && !gameOverFlag) jump = true;
});

document.addEventListener('click', () => {
  if(!jump && !gameOverFlag) jump = true;
});

document.addEventListener('touchstart', e => {
  e.preventDefault();
  if(!jump && !gameOverFlag) jump = true;
});

restartBtn.addEventListener('click', restartGame);

// --- Initialisation ---
player.style.bottom = groundOffset + 'px';
gameLoop();
startScore();

// Premier obstacle après 5-7 secondes
setTimeout(() => {
  if(!gameOverFlag) createObstacle();
  setInterval(() => { if(!gameOverFlag) createObstacle(); }, 1500);
}, 5000 + Math.random()*2000);
</script>
</body>
</html>